<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Difference-in-Differences with Unpoolable Data â€¢ undidR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Difference-in-Differences with Unpoolable Data">
<meta name="description" content="A framework for estimating difference-in-differences with unpoolable data, based on Karim, Webb, Austin, and Strumpf (2024) &lt;doi:10.48550/arXiv.2403.15910&gt;. Supports common or staggered adoption, multiple groups, and the inclusion of covariates. Also computes p-values for the aggregate average treatment effect on the treated via the randomization inference procedure described in MacKinnon and Webb (2020) &lt;doi:10.1016/j.jeconom.2020.04.024&gt;.">
<meta property="og:description" content="A framework for estimating difference-in-differences with unpoolable data, based on Karim, Webb, Austin, and Strumpf (2024) &lt;doi:10.48550/arXiv.2403.15910&gt;. Supports common or staggered adoption, multiple groups, and the inclusion of covariates. Also computes p-values for the aggregate average treatment effect on the treated via the randomization inference procedure described in MacKinnon and Webb (2020) &lt;doi:10.1016/j.jeconom.2020.04.024&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">undidR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/undidR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ebjamieson97/undidR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="undidr">undidR<a class="anchor" aria-label="anchor" href="#undidr"></a>
</h1></div>
<!-- badges: start -->

<p>The <strong>undidR</strong> package provides the framework for implementing difference-in-differences with unpoolable data (UNDID) developed in <a href="https://arxiv.org/abs/2403.15910v2" class="external-link">Karim, Webb, Austin, and Strumpf (2024)</a>. UNDID is designed to estimate the average treatment effect on the treated (ATT) in settings where data from different silos cannot be pooled together (potentially for reasons of confidentiality). The package supports both common and staggered adoption scenarios, as well as the optional inclusion of covariates. Additionally, <strong>undidR</strong> incorporates a randomization inference (RI) procedure, based on <a href="https://doi.org/10.1016/j.jeconom.2020.04.024" class="external-link">MacKinnon and Webb (2020)</a>, for calculating p-values for the UNDID ATT.</p>
<p>See the image below for an overview of the <strong>undidR</strong> framework: <img src="articles/figures/undidR_schematic.png" width="90%" style="display: block; margin: auto;"></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the stable release version of <code>undidR</code> from <a href="https://CRAN.R-project.org/package=undidR" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"undidR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>For a set of highly detailed examples see the package vignette using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"undidR"</span>, package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span></code></pre></div>
<p>The following code chunks show some basic examples of using <strong>undidR</strong> at each of its three stages.</p>
<div class="section level3">
<h3 id="stage-one-create_init_csv--create_diff_df">Stage One: <code>create_init_csv()</code> &amp; <code>create_diff_df()</code>
<a class="anchor" aria-label="anchor" href="#stage-one-create_init_csv--create_diff_df"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ebjamieson97/undidR" class="external-link">undidR</a></span><span class="op">)</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_init_csv.html">create_init_csv</a></span><span class="op">(</span>silo_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"73"</span>, <span class="st">"46"</span>, <span class="st">"54"</span>, <span class="st">"23"</span>, <span class="st">"86"</span>, <span class="st">"32"</span>,</span>
<span>                                       <span class="st">"71"</span>, <span class="st">"58"</span>, <span class="st">"64"</span>, <span class="st">"59"</span>, <span class="st">"85"</span>, <span class="st">"57"</span><span class="op">)</span>,</span>
<span>                        start_times <span class="op">=</span> <span class="st">"1989"</span>,</span>
<span>                        end_times <span class="op">=</span> <span class="st">"2000"</span>,</span>
<span>                        treatment_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                                            <span class="st">"1991"</span>, <span class="st">"1993"</span>, <span class="st">"1996"</span>, <span class="st">"1997"</span>,</span>
<span>                                            <span class="st">"1997"</span>, <span class="st">"1998"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; init.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpOSra8e/init.csv</span></span>
<span><span class="va">init</span></span>
<span><span class="co">#&gt;    silo_name start_time end_time treatment_time</span></span>
<span><span class="co">#&gt; 1         73       1989     2000        control</span></span>
<span><span class="co">#&gt; 2         46       1989     2000        control</span></span>
<span><span class="co">#&gt; 3         54       1989     2000        control</span></span>
<span><span class="co">#&gt; 4         23       1989     2000        control</span></span>
<span><span class="co">#&gt; 5         86       1989     2000        control</span></span>
<span><span class="co">#&gt; 6         32       1989     2000        control</span></span>
<span><span class="co">#&gt; 7         71       1989     2000           1991</span></span>
<span><span class="co">#&gt; 8         58       1989     2000           1993</span></span>
<span><span class="co">#&gt; 9         64       1989     2000           1996</span></span>
<span><span class="co">#&gt; 10        59       1989     2000           1997</span></span>
<span><span class="co">#&gt; 11        85       1989     2000           1997</span></span>
<span><span class="co">#&gt; 12        57       1989     2000           1998</span></span>
<span></span>
<span><span class="va">init_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"init.csv"</span><span class="op">)</span>,</span>
<span>                               winslash <span class="op">=</span> <span class="st">"/"</span>, mustWork <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">empty_diff_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_diff_df.html">create_diff_df</a></span><span class="op">(</span><span class="va">init_filepath</span>, date_format <span class="op">=</span> <span class="st">"yyyy"</span>,</span>
<span>                                freq <span class="op">=</span> <span class="st">"yearly"</span>,</span>
<span>                                covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"asian"</span>, <span class="st">"black"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; empty_diff_df.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpOSra8e/empty_diff_df.csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">empty_diff_df</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name gvar treat diff_times        gt RI start_time end_time</span></span>
<span><span class="co">#&gt; 1        73 1991     0  1991;1990 1991;1991  0       1989     2000</span></span>
<span><span class="co">#&gt; 2        73 1991     0  1992;1990 1991;1992  0       1989     2000</span></span>
<span><span class="co">#&gt; 3        73 1991     0  1993;1990 1991;1993  0       1989     2000</span></span>
<span><span class="co">#&gt; 4        73 1991     0  1994;1990 1991;1994  0       1989     2000</span></span>
<span><span class="co">#&gt;   diff_estimate diff_var diff_estimate_covariates diff_var_covariates</span></span>
<span><span class="co">#&gt; 1            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 2            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 3            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 4            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt;         covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4 asian;black;male        yyyy 1 year</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stage-two-undid_stage_two">Stage Two: <code>undid_stage_two()</code>
<a class="anchor" aria-label="anchor" href="#stage-two-undid_stage_two"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silo_data</span> <span class="op">&lt;-</span> <span class="va">silo71</span></span>
<span><span class="va">empty_diff_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/staggered"</span>, <span class="st">"empty_diff_df.csv"</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span>
<span><span class="va">stage2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/undid_stage_two.html">undid_stage_two</a></span><span class="op">(</span><span class="va">empty_diff_filepath</span>, silo_name <span class="op">=</span> <span class="st">"71"</span>,</span>
<span>                          silo_df <span class="op">=</span> <span class="va">silo_data</span>, time_column <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                          outcome_column <span class="op">=</span> <span class="st">"coll"</span>, silo_date_format <span class="op">=</span> <span class="st">"yyyy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; filled_diff_df_71.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpOSra8e/filled_diff_df_71.csv</span></span>
<span><span class="co">#&gt; trends_data_71.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpOSra8e/trends_data_71.csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stage2</span><span class="op">$</span><span class="va">diff_df</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name gvar treat diff_times        gt RI start_time   end_time</span></span>
<span><span class="co">#&gt; 1        71 1991     1  1991;1990 1991;1991  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt; 2        71 1991     1  1992;1990 1991;1992  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt; 3        71 1991     1  1993;1990 1991;1993  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt; 4        71 1991     1  1994;1990 1991;1994  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt;   diff_estimate    diff_var diff_estimate_covariates diff_var_covariates</span></span>
<span><span class="co">#&gt; 1    0.12916667 0.009447555              0.116348472         0.009397021</span></span>
<span><span class="co">#&gt; 2    0.06916667 0.008602222              0.069515594         0.008272557</span></span>
<span><span class="co">#&gt; 3    0.02546296 0.007975422              0.005133291         0.007767637</span></span>
<span><span class="co">#&gt; 4    0.02703901 0.008564103              0.029958108         0.008338060</span></span>
<span><span class="co">#&gt;         covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4 asian;black;male        yyyy 1 year</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stage2</span><span class="op">$</span><span class="va">trends_data</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name treatment_time time mean_outcome mean_outcome_residualized</span></span>
<span><span class="co">#&gt; 1        71           1991 1989    0.3061224                 0.1998800</span></span>
<span><span class="co">#&gt; 2        71           1991 1990    0.2708333                 0.1502040</span></span>
<span><span class="co">#&gt; 3        71           1991 1991    0.4000000                 0.1949109</span></span>
<span><span class="co">#&gt; 4        71           1991 1992    0.3400000                 0.1876636</span></span>
<span><span class="co">#&gt;         covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4 asian;black;male        yyyy 1 year</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stage-three-undid_stage_three">Stage Three: <code>undid_stage_three()</code>
<a class="anchor" aria-label="anchor" href="#stage-three-undid_stage_three"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/staggered"</span>, package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/undid_stage_three.html">undid_stage_three</a></span><span class="op">(</span><span class="va">dir_path</span>, agg <span class="op">=</span> <span class="st">"silo"</span>, covariates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             nperm <span class="op">=</span> <span class="fl">501</span><span class="op">)</span></span>
<span><span class="co">#&gt; Completed 100 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 200 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 300 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 400 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 500 of 500 permutations</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;   silo_name    silo_ATT    silo_SE  silo_p_val silo_jknife_SE silo_jknife_p_val</span></span>
<span><span class="co">#&gt; 1        57 -0.08144843 0.06215099 0.205650586     0.08649845       0.358207857</span></span>
<span><span class="co">#&gt; 2        58  0.05280529 0.02538483 0.042267963     0.02689507       0.054760168</span></span>
<span><span class="co">#&gt; 3        59  0.12365658 0.03562132 0.001823809     0.04254611       0.007377655</span></span>
<span><span class="co">#&gt; 4        64  0.07263498 0.03311326 0.035420278     0.03786681       0.063776333</span></span>
<span><span class="co">#&gt; 5        71  0.04618515 0.02595757 0.079666710     0.02796956       0.103295735</span></span>
<span><span class="co">#&gt; 6        85  0.07400401 0.03456541 0.041820821     0.04102590       0.082856564</span></span>
<span><span class="co">#&gt;      agg_ATT agg_ATT_SE agg_ATT_p_val agg_ATT_jknife_SE agg_ATT_jknife_p_val</span></span>
<span><span class="co">#&gt; 1 0.04797293 0.02570683     0.1210099        0.02816042            0.1636711</span></span>
<span><span class="co">#&gt; 2         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 3         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 4         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 5         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 6         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt;   agg_ATT_RI_p_val</span></span>
<span><span class="co">#&gt; 1             0.18</span></span>
<span><span class="co">#&gt; 2               NA</span></span>
<span><span class="co">#&gt; 3               NA</span></span>
<span><span class="co">#&gt; 4               NA</span></span>
<span><span class="co">#&gt; 5               NA</span></span>
<span><span class="co">#&gt; 6               NA</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=undidR" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ebjamieson97/undidR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ebjamieson97/undidR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing undidR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Eric Jamieson <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ebjamieson97/undidR/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/ebjamieson97/undidR/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/ebjamieson97/undidR" class="external-link"><img src="https://codecov.io/gh/ebjamieson97/undidR/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://CRAN.R-project.org/package=undidR" class="external-link"><img src="https://www.r-pkg.org/badges/version/undidR" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Jamieson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
