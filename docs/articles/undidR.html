<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>undidR â€¢ undidR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="undidR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">undidR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/undidR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ebjamieson97/undidR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>undidR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ebjamieson97/undidR/blob/HEAD/vignettes/undidR.Rmd" class="external-link"><code>vignettes/undidR.Rmd</code></a></small>
      <div class="d-none name"><code>undidR.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ebjamieson97/undidR" class="external-link">undidR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>undidR</strong> package implements
difference-in-differences with unpoolable data (UNDID); a framework that
enables the estimation of the average treatment effect on the treated
(ATT) when the data from different silos is not poolable. UNDID allows
for staggered or common adoption and the inclusion of covariates.</p>
<p>In addition, <strong>undidR</strong> also implements the
randomization inference (RI) procedure for difference-in-differences
described in <a href="https://doi.org/10.1016/j.jeconom.2020.04.024" class="external-link">MacKinnon and Webb
(2020)</a> to calculate RI p-values.</p>
<p>Below is an overview of the <strong>undidR</strong> framework:</p>
<div class="figure" style="text-align: center">
<img src="figures%2FundidR_schematic.png" alt="Schematic of the UNDID framework." width="90%"><p class="caption">
Schematic of the UNDID framework.
</p>
</div>
<p>The following sections detail some examples of implementing
<strong>undidR</strong> at each of its three stages for both staggered
and common adoption scenarios.</p>
</div>
<div class="section level2">
<h2 id="stage-one-initialize">1. Stage One: Initialize<a class="anchor" aria-label="anchor" href="#stage-one-initialize"></a>
</h2>
<p>When calling <code><a href="../reference/create_init_csv.html">create_init_csv()</a></code> silo names must be
specified along with their corresponding treatment times. Consequently,
the <code>silos_names</code> vector must be the same length as the
<code>treatment_times</code> vector.</p>
<p>All dates must be entered in the same date format. To see valid date
formats within the <strong>undidR</strong> package call
<code><a href="../reference/undid_date_formats.html">undid_date_formats()</a></code>.</p>
<p>Covariates may be specified when calling either
<code><a href="../reference/create_init_csv.html">create_init_csv()</a></code> or when calling
<code><a href="../reference/create_diff_df.html">create_diff_df()</a></code> via the <code>covariates</code>
parameter.</p>
<div class="section level3">
<h3 id="common-treatment-time-stage-one">1.1 Common Treatment Time (Stage One)<a class="anchor" aria-label="anchor" href="#common-treatment-time-stage-one"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, an initializing CSV is created detailing the silos</span></span>
<span><span class="co"># and their treatment times. Control silos (here, 73 and 46)</span></span>
<span><span class="co"># should be labelled with "control".</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_init_csv.html">create_init_csv</a></span><span class="op">(</span>silo_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"73"</span>, <span class="st">"46"</span>, <span class="st">"71"</span>, <span class="st">"58"</span><span class="op">)</span>,</span>
<span>                        start_times <span class="op">=</span> <span class="st">"1989"</span>,</span>
<span>                        end_times <span class="op">=</span> <span class="st">"2000"</span>,</span>
<span>                        treatment_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"control"</span>,</span>
<span>                                            <span class="st">"1991"</span>, <span class="st">"1991"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; init.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/init.csv</span></span>
<span><span class="va">init</span></span>
<span><span class="co">#&gt;   silo_name start_time end_time treatment_time</span></span>
<span><span class="co">#&gt; 1        73       1989     2000        control</span></span>
<span><span class="co">#&gt; 2        46       1989     2000        control</span></span>
<span><span class="co">#&gt; 3        71       1989     2000           1991</span></span>
<span><span class="co">#&gt; 4        58       1989     2000           1991</span></span>
<span></span>
<span><span class="co"># After the initializing CSV file is created, `create_diff_df()`</span></span>
<span><span class="co"># can be called. This creates the empty differences data frame which</span></span>
<span><span class="co"># will then be filled out at each individual silo for its respective portion.</span></span>
<span><span class="va">init_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"init.csv"</span><span class="op">)</span>,</span>
<span>                               winslash <span class="op">=</span> <span class="st">"/"</span>, mustWork <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">empty_diff_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_diff_df.html">create_diff_df</a></span><span class="op">(</span><span class="va">init_filepath</span>, date_format <span class="op">=</span> <span class="st">"yyyy"</span>,</span>
<span>                                freq <span class="op">=</span> <span class="st">"yearly"</span><span class="op">)</span></span>
<span><span class="co">#&gt; empty_diff_df.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/empty_diff_df.csv</span></span>
<span><span class="va">empty_diff_df</span></span>
<span><span class="co">#&gt;   silo_name treat common_treatment_time start_time   end_time  weights</span></span>
<span><span class="co">#&gt; 1        73     0                  1991 1989-01-01 2000-01-01 standard</span></span>
<span><span class="co">#&gt; 2        46     0                  1991 1989-01-01 2000-01-01 standard</span></span>
<span><span class="co">#&gt; 3        71     1                  1991 1989-01-01 2000-01-01 standard</span></span>
<span><span class="co">#&gt; 4        58     1                  1991 1989-01-01 2000-01-01 standard</span></span>
<span><span class="co">#&gt;   diff_estimate diff_var diff_estimate_covariates diff_var_covariates</span></span>
<span><span class="co">#&gt; 1            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 2            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 3            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 4            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt;   covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1       none        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2       none        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3       none        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4       none        yyyy 1 year</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="staggered-adoption-stage-one">1.2 Staggered Adoption (Stage One)<a class="anchor" aria-label="anchor" href="#staggered-adoption-stage-one"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The initializing CSV for staggered adoption is created in the same way.</span></span>
<span><span class="co"># When `create_diff_df()` is run, it will automatically detect whether or not</span></span>
<span><span class="co"># the initial setup is for a common adoption or staggered adoption scenario.</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_init_csv.html">create_init_csv</a></span><span class="op">(</span>silo_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"73"</span>, <span class="st">"46"</span>, <span class="st">"54"</span>, <span class="st">"23"</span>, <span class="st">"86"</span>, <span class="st">"32"</span>,</span>
<span>                                       <span class="st">"71"</span>, <span class="st">"58"</span>, <span class="st">"64"</span>, <span class="st">"59"</span>, <span class="st">"85"</span>, <span class="st">"57"</span><span class="op">)</span>,</span>
<span>                        start_times <span class="op">=</span> <span class="st">"1989"</span>,</span>
<span>                        end_times <span class="op">=</span> <span class="st">"2000"</span>,</span>
<span>                        treatment_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>                                            <span class="st">"1991"</span>, <span class="st">"1993"</span>, <span class="st">"1996"</span>, <span class="st">"1997"</span>,</span>
<span>                                            <span class="st">"1997"</span>, <span class="st">"1998"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; init.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/init.csv</span></span>
<span><span class="va">init</span></span>
<span><span class="co">#&gt;    silo_name start_time end_time treatment_time</span></span>
<span><span class="co">#&gt; 1         73       1989     2000        control</span></span>
<span><span class="co">#&gt; 2         46       1989     2000        control</span></span>
<span><span class="co">#&gt; 3         54       1989     2000        control</span></span>
<span><span class="co">#&gt; 4         23       1989     2000        control</span></span>
<span><span class="co">#&gt; 5         86       1989     2000        control</span></span>
<span><span class="co">#&gt; 6         32       1989     2000        control</span></span>
<span><span class="co">#&gt; 7         71       1989     2000           1991</span></span>
<span><span class="co">#&gt; 8         58       1989     2000           1993</span></span>
<span><span class="co">#&gt; 9         64       1989     2000           1996</span></span>
<span><span class="co">#&gt; 10        59       1989     2000           1997</span></span>
<span><span class="co">#&gt; 11        85       1989     2000           1997</span></span>
<span><span class="co">#&gt; 12        57       1989     2000           1998</span></span>
<span></span>
<span><span class="co"># Creating the empty differences data frame and associated CSV file is</span></span>
<span><span class="co"># the same for the case of staggered adoption as it is for common adoption.</span></span>
<span><span class="va">init_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"init.csv"</span><span class="op">)</span>,</span>
<span>                               winslash <span class="op">=</span> <span class="st">"/"</span>, mustWork <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">empty_diff_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_diff_df.html">create_diff_df</a></span><span class="op">(</span><span class="va">init_filepath</span>, date_format <span class="op">=</span> <span class="st">"yyyy"</span>,</span>
<span>                                freq <span class="op">=</span> <span class="st">"yearly"</span>,</span>
<span>                                covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"asian"</span>, <span class="st">"black"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; empty_diff_df.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/empty_diff_df.csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">empty_diff_df</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name gvar treat diff_times        gt RI start_time end_time</span></span>
<span><span class="co">#&gt; 1        73 1991     0  1991;1990 1991;1991  0       1989     2000</span></span>
<span><span class="co">#&gt; 2        73 1991     0  1992;1990 1991;1992  0       1989     2000</span></span>
<span><span class="co">#&gt; 3        73 1991     0  1993;1990 1991;1993  0       1989     2000</span></span>
<span><span class="co">#&gt; 4        73 1991     0  1994;1990 1991;1994  0       1989     2000</span></span>
<span><span class="co">#&gt;   diff_estimate diff_var diff_estimate_covariates diff_var_covariates</span></span>
<span><span class="co">#&gt; 1            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 2            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 3            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt; 4            NA       NA                       NA                  NA</span></span>
<span><span class="co">#&gt;         covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4 asian;black;male        yyyy 1 year</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="stage-two-silos">2. Stage Two: Silos<a class="anchor" aria-label="anchor" href="#stage-two-silos"></a>
</h2>
<p>The second stage function, <code><a href="../reference/undid_stage_two.html">undid_stage_two()</a></code>, creates
two CSV files. The first is the filled portion of the differences data
frame for the respective silo. The second captures the mean (and the
mean residualized by the specified covariates) of the outcome variable
from the <code>start_time</code> to the <code>end_time</code> in
intervals of <code>freq</code>.</p>
<p>These are returned from <code><a href="../reference/undid_stage_two.html">undid_stage_two()</a></code> as a list of
two data frames which can be accessed by the suffixes of
<code>$diff_df</code> and <code>$trends_data</code>, respectively.</p>
<div class="section level3">
<h3 id="common-treatment-time-stage-two">2.1 Common Treatment Time (Stage Two)<a class="anchor" aria-label="anchor" href="#common-treatment-time-stage-two"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># When calling `undid_stage_two()`, ensure that the `time_column` of</span></span>
<span><span class="co"># the `silo_df` contains only character values, i.e. date strings.</span></span>
<span><span class="va">silo_data</span> <span class="op">&lt;-</span> <span class="va">silo71</span></span>
<span><span class="va">silo_data</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">silo_data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">empty_diff_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/common"</span>, <span class="st">"empty_diff_df.csv"</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span>
<span><span class="va">stage2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/undid_stage_two.html">undid_stage_two</a></span><span class="op">(</span><span class="va">empty_diff_filepath</span>, silo_name <span class="op">=</span> <span class="st">"71"</span>,</span>
<span>                          silo_df <span class="op">=</span> <span class="va">silo_data</span>, time_column <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                          outcome_column <span class="op">=</span> <span class="st">"coll"</span>, silo_date_format <span class="op">=</span> <span class="st">"yyyy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; filled_diff_df_71.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/filled_diff_df_71.csv</span></span>
<span><span class="co">#&gt; trends_data_71.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/trends_data_71.csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stage2</span><span class="op">$</span><span class="va">diff_df</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name treat common_treatment_time start_time   end_time           weights</span></span>
<span><span class="co">#&gt; 1        71     1                  1991 1989-01-01 2000-01-01 0.914762741652021</span></span>
<span><span class="co">#&gt;   diff_estimate    diff_var diff_estimate_covariates diff_var_covariates</span></span>
<span><span class="co">#&gt; 1    0.05879783 0.002597221                       NA                  NA</span></span>
<span><span class="co">#&gt;   covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1       none        yyyy 1 year</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stage2</span><span class="op">$</span><span class="va">trends_data</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name treatment_time time mean_outcome mean_outcome_residualized</span></span>
<span><span class="co">#&gt; 1        71           1991 1989    0.3061224                        NA</span></span>
<span><span class="co">#&gt; 2        71           1991 1990    0.2708333                        NA</span></span>
<span><span class="co">#&gt; 3        71           1991 1991    0.4000000                        NA</span></span>
<span><span class="co">#&gt; 4        71           1991 1992    0.3400000                        NA</span></span>
<span><span class="co">#&gt;   covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1       none        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2       none        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3       none        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4       none        yyyy 1 year</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="staggered-adoption-stage-two">2.2 Staggered Adoption (Stage Two)<a class="anchor" aria-label="anchor" href="#staggered-adoption-stage-two"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here we can see that calling `undid_stage_two()` for staggered adoption</span></span>
<span><span class="co"># is no different than calling `undid_stage_two()` for common adoption.</span></span>
<span><span class="va">silo_data</span> <span class="op">&lt;-</span> <span class="va">silo71</span></span>
<span><span class="va">silo_data</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">silo_data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">empty_diff_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/staggered"</span>, <span class="st">"empty_diff_df.csv"</span>,</span>
<span>                                    package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span>
<span><span class="va">stage2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/undid_stage_two.html">undid_stage_two</a></span><span class="op">(</span><span class="va">empty_diff_filepath</span>, silo_name <span class="op">=</span> <span class="st">"71"</span>,</span>
<span>                          silo_df <span class="op">=</span> <span class="va">silo_data</span>, time_column <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                          outcome_column <span class="op">=</span> <span class="st">"coll"</span>, silo_date_format <span class="op">=</span> <span class="st">"yyyy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; filled_diff_df_71.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/filled_diff_df_71.csv</span></span>
<span><span class="co">#&gt; trends_data_71.csv saved to: C:/Users/Eric Bruce Jamieson/AppData/Local/Temp/RtmpMvtemU/trends_data_71.csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stage2</span><span class="op">$</span><span class="va">diff_df</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name gvar treat diff_times        gt RI start_time   end_time</span></span>
<span><span class="co">#&gt; 1        71 1991     1  1991;1990 1991;1991  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt; 2        71 1991     1  1992;1990 1991;1992  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt; 3        71 1991     1  1993;1990 1991;1993  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt; 4        71 1991     1  1994;1990 1991;1994  0 1989-01-01 2000-01-01</span></span>
<span><span class="co">#&gt;   diff_estimate    diff_var diff_estimate_covariates diff_var_covariates</span></span>
<span><span class="co">#&gt; 1    0.12916667 0.009447555              0.116348472         0.009397021</span></span>
<span><span class="co">#&gt; 2    0.06916667 0.008602222              0.069515594         0.008272557</span></span>
<span><span class="co">#&gt; 3    0.02546296 0.007975422              0.005133291         0.007767637</span></span>
<span><span class="co">#&gt; 4    0.02703901 0.008564103              0.029958108         0.008338060</span></span>
<span><span class="co">#&gt;         covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4 asian;black;male        yyyy 1 year</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stage2</span><span class="op">$</span><span class="va">trends_data</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name treatment_time time mean_outcome mean_outcome_residualized</span></span>
<span><span class="co">#&gt; 1        71           1991 1989    0.3061224                 0.1998800</span></span>
<span><span class="co">#&gt; 2        71           1991 1990    0.2708333                 0.1502040</span></span>
<span><span class="co">#&gt; 3        71           1991 1991    0.4000000                 0.1949109</span></span>
<span><span class="co">#&gt; 4        71           1991 1992    0.3400000                 0.1876636</span></span>
<span><span class="co">#&gt;         covariates date_format   freq</span></span>
<span><span class="co">#&gt; 1 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 2 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 3 asian;black;male        yyyy 1 year</span></span>
<span><span class="co">#&gt; 4 asian;black;male        yyyy 1 year</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="stage-three-analysis">3. Stage Three: Analysis<a class="anchor" aria-label="anchor" href="#stage-three-analysis"></a>
</h2>
<p>The third stage of <strong>undidR</strong> produces the aggregate ATT
estimate, its standard errors, and its p-values, as well as group level
ATT estimates for staggered adoption.</p>
<p>In the case of staggered adoption these group level ATTs can either
be grouped by silo (<code>agg = "silo"</code>), by treatment time
(<code>agg = "g"</code>), or by treatment time for every time period
after treatment has started (<code>agg = "gt"</code>).</p>
<p>Plotting of parallel trends figures is conveniently fast tracked by
the use of the <code><a href="../reference/plot_parallel_trends.html">plot_parallel_trends()</a></code> function. Some of the
most important parameters are highlighted in the examples below, but
there are a plethora options. Call <code>?plot_parallel_trends()</code>
to see all the parameters and their descriptions.</p>
<div class="section level3">
<h3 id="common-treatment-time-stage-three">3.1 Common Treatment Time (Stage Three)<a class="anchor" aria-label="anchor" href="#common-treatment-time-stage-three"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># `undid_stage_three()`, given a `dir_path`, will search that folder</span></span>
<span><span class="co"># for all CSV files that begin with "filled_diff_df_" and stitch</span></span>
<span><span class="co"># them together in order to compute the group level ATTs, aggregate ATT</span></span>
<span><span class="co"># and associated standard errors and p-values.</span></span>
<span><span class="va">dir_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/common"</span>, package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/undid_stage_three.html">undid_stage_three</a></span><span class="op">(</span><span class="va">dir_path</span>, covariates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in .stage_three_common(diff_df, weights, nperm): `nperm` was set to 1001 but the number of unique permutations is only 6 </span></span>
<span><span class="co">#&gt; Overriding `nperm` to: 6</span></span>
<span><span class="co">#&gt; Warning in .stage_three_common(diff_df, weights, nperm): Randomization</span></span>
<span><span class="co">#&gt; inference may not be valid with `nperm` &lt; 500.</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;   treatment_time   agg_ATT agg_ATT_SE      pval agg_ATT_jknife_SE jknife_pval</span></span>
<span><span class="co">#&gt; 1           7670 0.0213912 0.02509805 0.4838232         0.0434711   0.6713731</span></span>
<span><span class="co">#&gt;   RI_pval</span></span>
<span><span class="co">#&gt; 1     0.4</span></span>
<span></span>
<span><span class="co"># We can also view a parallel trends plot of our silos by callling</span></span>
<span><span class="co"># `plot_parallel_trends()`. This function will search a folder for all</span></span>
<span><span class="co"># CSV files that start with "trends_data" and combine them. The combined</span></span>
<span><span class="co"># data is returned by the function.</span></span>
<span><span class="va">trends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_parallel_trends.html">plot_parallel_trends</a></span><span class="op">(</span></span>
<span>  <span class="va">dir_path</span>,</span>
<span>  simplify_legend <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># Setting to `FALSE` puts every silo in legend</span></span>
<span>  lwd <span class="op">=</span> <span class="fl">3</span>,                 <span class="co"># Set line width</span></span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,          <span class="co"># (min, max) of y-axis</span></span>
<span>  xdates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1989-01-01"</span>,</span>
<span>                     <span class="st">"1991-01-01"</span>,</span>
<span>                     <span class="st">"1993-01-01"</span>, <span class="co"># Explicity declare dates on x-axis</span></span>
<span>                     <span class="st">"1995-01-01"</span>,</span>
<span>                     <span class="st">"1997-01-01"</span>,</span>
<span>                     <span class="st">"1999-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  date_format <span class="op">=</span> <span class="st">"%Y"</span>, <span class="co"># Specify x-axis date format</span></span>
<span>  ylabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># Values on y-axis</span></span>
<span>  legend_location <span class="op">=</span> <span class="st">"topleft"</span>, <span class="co"># Where should the legend go?</span></span>
<span>  legend_on <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Defaults `TRUE`, can be set to `FALSE` to omit legend</span></span>
<span>  ylab <span class="op">=</span> <span class="st">"coll"</span>, <span class="co"># y-axis title</span></span>
<span>  treatment_colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="co"># Set colours of treatment silos</span></span>
<span>                       <span class="st">"coral"</span><span class="op">)</span>,</span>
<span>  control_colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#2fa7cf"</span>, <span class="co"># Colours can be entered as hexcodes</span></span>
<span>                     <span class="st">"skyblue"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="undidR_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trends</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;   silo_name treatment_time       time mean_outcome mean_outcome_residualized</span></span>
<span><span class="co">#&gt; 1        46        control 1989-01-01    0.5245902                        NA</span></span>
<span><span class="co">#&gt; 2        46        control 1990-01-01    0.4545455                        NA</span></span>
<span><span class="co">#&gt; 3        46        control 1991-01-01    0.5490196                        NA</span></span>
<span><span class="co">#&gt; 4        46        control 1992-01-01    0.6250000                        NA</span></span>
<span><span class="co">#&gt;   covariates date_format   freq         y</span></span>
<span><span class="co">#&gt; 1       none        yyyy 1 year 0.5245902</span></span>
<span><span class="co">#&gt; 2       none        yyyy 1 year 0.4545455</span></span>
<span><span class="co">#&gt; 3       none        yyyy 1 year 0.5490196</span></span>
<span><span class="co">#&gt; 4       none        yyyy 1 year 0.6250000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="staggered-adoption-stage-three">3.2 Staggered Adoption (Stage Three)<a class="anchor" aria-label="anchor" href="#staggered-adoption-stage-three"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># When calling `undid_stage_three()` for staggered adoption it is</span></span>
<span><span class="co"># important to specify the aggregation method, `agg`.</span></span>
<span><span class="va">dir_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/staggered"</span>, package <span class="op">=</span> <span class="st">"undidR"</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/undid_stage_three.html">undid_stage_three</a></span><span class="op">(</span><span class="va">dir_path</span>, agg <span class="op">=</span> <span class="st">"silo"</span>, covariates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             nperm <span class="op">=</span> <span class="fl">501</span><span class="op">)</span></span>
<span><span class="co">#&gt; Completed 100 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 200 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 300 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 400 of 500 permutations</span></span>
<span><span class="co">#&gt; Completed 500 of 500 permutations</span></span>
<span></span>
<span><span class="co"># The `nperm` parameter specifies how many permutations</span></span>
<span><span class="co"># to consider for randomization inference.</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;   silo_name    silo_ATT    silo_SE  silo_p_val silo_jknife_SE silo_jknife_p_val</span></span>
<span><span class="co">#&gt; 1        57 -0.08144843 0.06215099 0.205650586     0.08649845       0.358207857</span></span>
<span><span class="co">#&gt; 2        58  0.05280529 0.02538483 0.042267963     0.02689507       0.054760168</span></span>
<span><span class="co">#&gt; 3        59  0.12365658 0.03562132 0.001823809     0.04254611       0.007377655</span></span>
<span><span class="co">#&gt; 4        64  0.07263498 0.03311326 0.035420278     0.03786681       0.063776333</span></span>
<span><span class="co">#&gt; 5        71  0.04618515 0.02595757 0.079666710     0.02796956       0.103295735</span></span>
<span><span class="co">#&gt; 6        85  0.07400401 0.03456541 0.041820821     0.04102590       0.082856564</span></span>
<span><span class="co">#&gt;      agg_ATT agg_ATT_SE agg_ATT_p_val agg_ATT_jknife_SE agg_ATT_jknife_p_val</span></span>
<span><span class="co">#&gt; 1 0.04797293 0.02570683     0.1210099        0.02816042            0.1636711</span></span>
<span><span class="co">#&gt; 2         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 3         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 4         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 5         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt; 6         NA         NA            NA                NA                   NA</span></span>
<span><span class="co">#&gt;   agg_ATT_RI_p_val</span></span>
<span><span class="co">#&gt; 1            0.152</span></span>
<span><span class="co">#&gt; 2               NA</span></span>
<span><span class="co">#&gt; 3               NA</span></span>
<span><span class="co">#&gt; 4               NA</span></span>
<span><span class="co">#&gt; 5               NA</span></span>
<span><span class="co">#&gt; 6               NA</span></span>
<span></span>
<span><span class="co"># If we have many silos, but want to view a parallel trends plot</span></span>
<span><span class="co"># we can set `combine = TRUE` when calling `plot_parallel_trends()`</span></span>
<span><span class="co"># which will combine all treatment silos into a single line, and all</span></span>
<span><span class="co"># control silos into a single line.</span></span>
<span><span class="va">trends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_parallel_trends.html">plot_parallel_trends</a></span><span class="op">(</span></span>
<span>  <span class="va">dir_path</span>,</span>
<span>  combine <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Plots one line for control and one line for treated</span></span>
<span>  simplify_legend <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Reduces legend to simply "Control" and "Treated"</span></span>
<span>  lwd <span class="op">=</span> <span class="fl">3</span>,                 <span class="co"># Set line width</span></span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span><span class="op">)</span>,          <span class="co"># (min, max) of y-axis</span></span>
<span>  xdates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1989-01-01"</span>,</span>
<span>                     <span class="st">"1991-01-01"</span>,</span>
<span>                     <span class="st">"1993-01-01"</span>, <span class="co"># Explicity declare dates on x-axis</span></span>
<span>                     <span class="st">"1995-01-01"</span>,</span>
<span>                     <span class="st">"1997-01-01"</span>,</span>
<span>                     <span class="st">"1999-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  date_format <span class="op">=</span> <span class="st">"%Y"</span>, <span class="co"># Specify x-axis date format</span></span>
<span>  ylabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span>, <span class="co"># Values on y-axis</span></span>
<span>  legend_location <span class="op">=</span> <span class="st">"topright"</span>, <span class="co"># Where should the legend go?</span></span>
<span>  treatment_indicator_lwd <span class="op">=</span> <span class="fl">2</span>, <span class="co"># line width for the treatment indicator lines</span></span>
<span>  treatment_indicator_alpha <span class="op">=</span> <span class="fl">0.2</span>, <span class="co"># transparency for treatment indicator lines</span></span>
<span>  treatment_indicator_col <span class="op">=</span> <span class="st">"red"</span> <span class="co"># colour for treatment indicator lines</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="undidR_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trends</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;         time silo_name         y treatment_time date_format</span></span>
<span><span class="co">#&gt; 1 1989-01-01 Treatment 0.3367429           &lt;NA&gt;        yyyy</span></span>
<span><span class="co">#&gt; 2 1989-01-01   Control 0.4322536           &lt;NA&gt;        yyyy</span></span>
<span><span class="co">#&gt; 3 1990-01-01 Treatment 0.3521812           &lt;NA&gt;        yyyy</span></span>
<span><span class="co">#&gt; 4 1990-01-01   Control 0.4222644           &lt;NA&gt;        yyyy</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Karim, S., Webb, M., Austin, N., and Strumpf, E. 2024.
Difference-in-Differences with Unpoolable Data. <a href="https://arxiv.org/abs/2403.15910" class="external-link">https://arxiv.org/abs/2403.15910</a></p>
<p>MacKinnon, J. and Webb, M. 2020. Randomization inference for
difference-in-differences with few treated clusters. Journal of
Econometrics. <a href="https://doi.org/10.1016/j.jeconom.2020.04.024" class="external-link">https://doi.org/10.1016/j.jeconom.2020.04.024</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Jamieson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
